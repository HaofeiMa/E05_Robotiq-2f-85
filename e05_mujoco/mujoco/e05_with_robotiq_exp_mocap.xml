<mujoco model="e05">
    <compiler angle="radian" meshdir="../meshes/" />
    <size njmax="500" nconmax="100" />

    <!-- 加载 E05 机械臂模型与基本配置 -->
    <asset>
        <mesh name="base_link" file="e05/base_link.STL" />
        <mesh name="link1" file="e05/link1.STL" />
        <mesh name="link2" file="e05/link2.STL" />
        <mesh name="link3" file="e05/link3.STL" />
        <mesh name="link4" file="e05/link4.STL" />
        <mesh name="link5" file="e05/link5.STL" />
        <mesh name="link6" file="e05/link6.STL" />
        <texture type="skybox" builtin="gradient" rgb1="0.3 0.5 0.7" rgb2="0 0 0" width="512" height="3072"/>
        <!-- <texture builtin="flat" height="1278" mark="cross" markrgb="1 1 1" name="texgeom" random="0.01" rgb1="0.8 0.6 0.4" rgb2="0.8 0.6 0.4" type="cube" width="127"/> -->
        <!-- <material name="geom" texture="texgeom" texuniform="true"/> -->
        <texture type="2d" name="groundplane" builtin="checker" mark="edge" rgb1="0.2 0.3 0.4" rgb2="0.1 0.2 0.3"
      markrgb="0.8 0.8 0.8" width="300" height="300"/>
        <material name="groundplane" texture="groundplane" texuniform="true" texrepeat="5 5" reflectance="0.2"/>
    </asset>

    
    <!-- 加载 Robotiq-2f-85 夹爪与基本配置 -->
    <compiler angle="radian"/>
    <option timestep="0.002"/>
    <asset>
        <mesh name="robotiq-2f-base" file="robotiq-2f-85/robotiq-2f-base.stl" scale="0.001 0.001 0.001" />
        <mesh name="robotiq-2f-driver" file="robotiq-2f-85/robotiq-2f-driver.stl" scale="0.001 0.001 0.001" />
        <mesh name="robotiq-2f-coupler" file="robotiq-2f-85/robotiq-2f-coupler.stl" scale="0.001 0.001 0.001" />
        <mesh name="robotiq-2f-follower" file="robotiq-2f-85/robotiq-2f-follower.stl" scale="0.001 0.001 0.001" />
        <mesh name="robotiq-2f-pad" file="robotiq-2f-85/robotiq-2f-pad.stl" scale="0.001 0.001 0.001" />
        <mesh name="robotiq-2f-spring_link" file="robotiq-2f-85/robotiq-2f-spring_link.stl" scale="0.001 0.001 0.001" />
    </asset>
    <default>
        <default class="robotiq2f85">
            <joint damping=".1" pos="0 0 0" axis="1 0 0" limited="true" />
            <geom rgba=".1 .1 .1 1" type="mesh" contype="0" conaffinity="0" group="1"/>
            <default class="robotiq_col">
                <geom rgba=".3 .4 .5 1" type="mesh" contype="1" conaffinity="0" group="3"/>
            </default>
            <default class="robotiq_pad_col">
                <geom rgba=".3 .4 .5 1" type="mesh" contype="1" conaffinity="1" group="3" condim="4"/>
            </default>
        </default>
    </default>

    <!-- 加载实验环境材料 -->
    <asset>
        <material name="table_mat" specular="0" shininess="0.5" reflectance="0" rgba="0.7 0.7 0.7 1"></material>
        <material name="block_mat" specular="0" shininess="0.5" reflectance="0" rgba="0.2 0.2 0.2 1"></material>
        <material name="block0_mat" specular="0" shininess="0.5" reflectance="0" rgba="1 0 0 1"></material>
        <material name="block1_mat" specular="0" shininess="0.5" reflectance="0" rgba="0 0 1 1"></material>
        <material name="block2_mat" specular="0" shininess="0.5" reflectance="0" rgba="0.2 0.8 0.8 1"></material>
        <material name="block3_mat" specular="0" shininess="0.5" reflectance="0" rgba="0.8 0.2 0.8 1"></material>
        <material name="block4_mat" specular="0" shininess="0.5" reflectance="0" rgba="0.2 0.2 0.8 1"></material>
        <material name="block5_mat" specular="0" shininess="0.5" reflectance="0" rgba="0.8 0.2 0.2 1"></material>
        <material name="floor_mat" specular="0" shininess="0.5" reflectance="0" rgba="0.2 0.2 0.2 1"></material>
    </asset>

    <!-- 机器人本体 -->
    <worldbody>
        <!-- 仿真环境设置定义 -->
        <light diffuse="0.6 0.6 0.6" pos="1.2 0.75 3"/>
        <light diffuse="0.6 0.6 0.6" pos="1.2 0.45 3" dir="0 0.2 -0.8" directional="true"/>
        <!-- <light cutoff="100" diffuse="0.5 0.5 0.5" dir="-0 0 -1.3" directional="true" exponent="1" pos="0 0 1.3" specular=".1 .1 .1"/> -->
        <geom name="floor" size="0 0 0.05" type="plane" material="groundplane"/>
        <camera name="camera_env" mode="trackcom" euler="0.85 0.5 0.45" pos="2.1 -0.5 1.95" fovy="60" />


        <!-- E05 机械臂与 Robotiq 2f-85 夹爪 运动链 -->
        <body name="base_link" pos="0.75 0.75 0.4"> <!-- 调整机器人底座的位置 -->
            <geom type="mesh" contype="0" conaffinity="0" group="1" rgba="0.501961 0.501961 0.501961 1" mesh="base_link" />
            <geom type="mesh" rgba="0.501961 0.501961 0.501961 1" mesh="base_link" />
        </body>
        <body name="link1" pos="0.75 0.75 0.4735">
            <inertial pos="-0.0218175 -1.34618e-05 0.0953928" quat="0.696024 -0.147787 -0.14991 0.686467" mass="2.58559" diaginertia="0.0143616 0.0141793 0.00506835" />
            <!-- <joint name="joint1" pos="0 0 0" axis="0 0 1" limited="true" range="-3.14159 3.14159" damping='200' /> -->
            <joint name="joint1" pos="0 0 0" axis="0 0 1" armature="1.5708" limited="true" range="-3.14159 3.14159" damping='200' />
            <geom type="mesh" contype="0" conaffinity="0" group="1" rgba="0.772549 0.752941 0.733333 1" mesh="link1" />
            <geom type="mesh" rgba="0.772549 0.752941 0.733333 1" mesh="link1" />
            <body name="link2" pos="0 0 0.1465" quat="0.5 -0.5 -0.5 0.5">
                <inertial pos="4.42659e-06 -0.15814 0.130501" quat="0.491565 0.508215 -0.508335 0.491606" mass="1.21311" diaginertia="0.0159807 0.0154676 0.00149746" />
                <joint name="joint2" pos="0 0 0" axis="0 0 -1" limited="true" range="-3.14159 3.14159" damping='200' />
                <geom type="mesh" contype="0" conaffinity="0" group="1" rgba="0.792157 0.819608 0.933333 1" mesh="link2" />
                <geom type="mesh" rgba="0.792157 0.819608 0.933333 1" mesh="link2" />
                <body name="link3" pos="0 -0.38 0" quat="0.707107 0 0 0.707107">
                    <inertial pos="-0.0414786 1.14213e-05 0.0194164" quat="0.601987 0.371892 0.373044 0.600122" mass="1.53239" diaginertia="0.00608826 0.00587729 0.00215529" />
                    <!-- <joint name="joint3" pos="0 0 0" axis="0 0 -1" limited="true" range="-3.14159 3.14159" damping='200' /> -->
                    <joint name="joint3" pos="0 0 0" axis="0 0 -1" armature="1.5708" limited="true" range="-3.14159 3.14159" damping='200' />
                    <geom type="mesh" contype="0" conaffinity="0" group="1" rgba="0.866667 0.866667 0.890196 1" mesh="link3" />
                    <geom type="mesh" rgba="0.866667 0.866667 0.890196 1" mesh="link3" />
                    <body name="link4" pos="0 0 0" quat="0.5 -0.5 0.5 -0.5">
                        <inertial pos="3.8238e-05 -0.0589656 -0.257081" quat="0.988248 -0.152858 -0.000415939 -0.000860755" mass="0.475189" diaginertia="0.00538322 0.0052745 0.000778119" />
                        <joint name="joint4" pos="0 0 0" axis="0 0 1" limited="true" range="-3.14159 3.14159" damping='100' />
                        <geom type="mesh" contype="0" conaffinity="0" group="1" rgba="0.772549 0.752941 0.733333 1" mesh="link4" />
                        <geom type="mesh" rgba="0.772549 0.752941 0.733333 1" mesh="link4" />
                        <body name="link5" pos="0 0 -0.42" quat="0.707105 -0.707108 0 0">
                            <inertial pos="1.42418e-06 0.0365906 -0.0159722" quat="0.527641 0.849468 0.000113207 -7.90953e-05" mass="0.811919" diaginertia="0.00229898 0.00217056 0.000742684" />
                            <!-- <joint name="joint5" pos="0 0 0" axis="0 0 1" limited="true" range="-3.14159 3.14159" damping='100' /> -->
                            <joint name="joint5" pos="0 0 0" axis="0 0 1" armature="1.5708" limited="true" range="-3.14159 3.14159" damping='100' />
                            <geom type="mesh" contype="0" conaffinity="0" group="1" rgba="0.792157 0.819608 0.933333 1" mesh="link5" />
                            <geom type="mesh" rgba="0.792157 0.819608 0.933333 1" mesh="link5" />
                            <body name="link6" pos="0 0.155 0" quat="0.707105 -0.707108 0 0">
                                <inertial pos="-4.84703e-06 0.00109667 -0.0032406" quat="0.999926 0.0120786 2.3554e-05 -0.00120144" mass="0.75038" diaginertia="0.00129697 0.00122959 0.00051245" />
                                <joint name="joint6" pos="0 0 0" axis="0 0 -1" limited="true" range="-3.14159 3.14159" armature="0.5" damping='100' />
                                <geom type="mesh" contype="0" conaffinity="0" group="1" rgba="0.776471 0.756863 0.737255 1" mesh="link6" />
                                <geom type="mesh" rgba="0.776471 0.756863 0.737255 1" mesh="link6" />
                                <geom size="0.01" contype="0" conaffinity="0" group="1" rgba="1 0 0 1" />
                                
                                <!-- 导入 Robotiq 2f-85 运动链 -->
                                <body name="robotiq_2f_85" pos="0 0 0" childclass="robotiq2f85">
                                    <geom mesh="robotiq-2f-base" />
                                    <geom class="robotiq_col" type="mesh" mesh="robotiq-2f-base" euler="0 0 0"/>
                                    <body name="robotiq_2f_85_right_driver" pos="0 0.0306011 0.054904">
                                        <inertial pos="0 0.01575 0.05295" quat="0.738425 0.674335 0 0" mass="0.2" diaginertia="0.00043212 0.000431866 0.000360253" />
                                        <joint name="robotiq_2f_85_right_driver_joint" range="0 0.834" />
                                        <geom mesh="robotiq-2f-driver" />
                                        <geom pos="0 0.0315 -0.0041" mesh="robotiq-2f-coupler" />
                                        <geom class="robotiq_col" pos="0 0.0315 -0.0041" type="mesh" mesh="robotiq-2f-coupler" />
                                        <body name="robotiq_2f_85_right_follower" pos="0 0.0376 0.043">
                                            <inertial pos="0 0 0.055" quat="0.707107 0.707107 0 0" mass="0.2" diaginertia="0.000380833 0.000380833 0.00036" />
                                            <joint name="robotiq_2f_85_right_follower_joint" range="-2.96706 2.96706" />
                                            <geom mesh="robotiq-2f-follower" />
                                            <geom type="mesh" mesh="robotiq-2f-pad" rgba="1 1 1 1"/>
                                            <geom class="robotiq_pad_col" type="box" size=".01 .003 .0175" pos="0 -.021 .031"/>
                                            <geom class="robotiq_pad_col" type="capsule" size=".004 .008" pos="0 -.019 .045" axisangle="0.1 1 0 1.57"/>
                                            <geom class="robotiq_pad_col" type="capsule" size=".004 .008" pos="0 -.019 .036" axisangle="0.1 1 0 1.57"/>
                                            <geom class="robotiq_pad_col" type="capsule" size=".004 .008" pos="0 -.019 .028" axisangle="0.1 1 0 1.57"/>
                                            <geom class="robotiq_pad_col" type="capsule" size=".004 .008" pos="0 -.019 .019" axisangle="0.1 1 0 1.57"/>
                                            <geom class="robotiq_pad_col" type="capsule" size=".004 .008" pos="0 -.019 .045" axisangle="-.1 1 0 1.57"/>
                                            <geom class="robotiq_pad_col" type="capsule" size=".004 .008" pos="0 -.019 .036" axisangle="-.1 1 0 1.57"/>
                                            <geom class="robotiq_pad_col" type="capsule" size=".004 .008" pos="0 -.019 .028" axisangle="-.1 1 0 1.57"/>
                                            <geom class="robotiq_pad_col" type="capsule" size=".004 .008" pos="0 -.019 .019" axisangle="-.1 1 0 1.57"/>
                                        </body>
                                    </body>
                                    <body name="robotiq_2f_85_right_spring_link" pos="0 0.012 0.0614">
                                        <inertial pos="0 0 0.055" quat="0.707107 0.707107 0 0" mass="0.1" diaginertia="0.000190833 0.000190833 0.00018" />
                                        <joint name="robotiq_2f_85_right_spring_link_joint" range="-2.96706 2.96706" />
                                        <geom mesh="robotiq-2f-spring_link"/>
                                        <geom class="robotiq_col" type="box" size=".0125 .007 .014" pos="0 .032 .0365" euler="-.7 0 0"/>
                                        <geom class="robotiq_col" type="box" size=".0180 .007 .022" pos="0 .012 0.013" euler="-.7 0 0"/>
                                        <site name="gripper_right" type="sphere" size="0.01" pos="0 0.037 0.043" rgba="1 0 0 1" group="3"/>
                                    </body>
                                    <body name="robotiq_2f_85_left_driver" pos="0 -0.0306011 0.054904" quat="0 0 0 1">
                                        <inertial pos="0 0.01575 0.05295" quat="0.738425 0.674335 0 0" mass="0.2" diaginertia="0.00043212 0.000431866 0.000360253" />
                                        <joint name="robotiq_2f_85_left_driver_joint" range="0 0.834" />
                                        <geom mesh="robotiq-2f-driver" />
                                        <geom pos="0 0.0315 -0.0041" mesh="robotiq-2f-coupler" />
                                        <geom class="robotiq_col" pos="0 0.0315 -0.0041" type="mesh" mesh="robotiq-2f-coupler" />
                                        <body name="robotiq_2f_85_left_follower" pos="0 0.0376 0.043">
                                            <inertial pos="0 0 0.055" quat="0.707107 0.707107 0 0" mass="0.2" diaginertia="0.000380833 0.000380833 0.00036" />
                                            <joint name="robotiq_2f_85_left_follower_joint" range="-2.96706 2.96706" />
                                            <geom mesh="robotiq-2f-follower" />
                                            <geom type="mesh" mesh="robotiq-2f-pad" rgba="1 1 1 1"/>
                                            <geom class="robotiq_pad_col" type="box" size=".01 .003 .0175" pos="0 -.021 .031"/>
                                            <geom class="robotiq_pad_col" type="capsule" size=".004 .008" pos="0 -.019 .045" axisangle="0.1 1 0 1.57"/>
                                            <geom class="robotiq_pad_col" type="capsule" size=".004 .008" pos="0 -.019 .036" axisangle="0.1 1 0 1.57"/>
                                            <geom class="robotiq_pad_col" type="capsule" size=".004 .008" pos="0 -.019 .028" axisangle="0.1 1 0 1.57"/>
                                            <geom class="robotiq_pad_col" type="capsule" size=".004 .008" pos="0 -.019 .019" axisangle="0.1 1 0 1.57"/>
                                            <geom class="robotiq_pad_col" type="capsule" size=".004 .008" pos="0 -.019 .045" axisangle="-.1 1 0 1.57"/>
                                            <geom class="robotiq_pad_col" type="capsule" size=".004 .008" pos="0 -.019 .036" axisangle="-.1 1 0 1.57"/>
                                            <geom class="robotiq_pad_col" type="capsule" size=".004 .008" pos="0 -.019 .028" axisangle="-.1 1 0 1.57"/>
                                            <geom class="robotiq_pad_col" type="capsule" size=".004 .008" pos="0 -.019 .019" axisangle="-.1 1 0 1.57"/>
                                        </body>
                                    </body>
                                    <body name="robotiq_2f_85_left_spring_link" pos="0 -0.012 0.0614" quat="0 0 0 1">
                                        <inertial pos="0 0 0.055" quat="0.707107 0.707107 0 0" mass="0.1" diaginertia="0.000190833 0.000190833 0.00018" />
                                        <joint name="robotiq_2f_85_left_spring_link_joint" range="-2.96706 2.96706" />
                                        <geom mesh="robotiq-2f-spring_link"/>
                                        <geom class="robotiq_col" type="box" size=".0125 .007 .014" pos="0 .032 .0365" euler="-.7 0 0"/>
                                        <geom class="robotiq_col" type="box" size=".0180 .007 .022" pos="0 .012 0.013" euler="-.7 0 0"/>
                                        <site name="gripper_left" type="sphere" size="0.01" pos="0 0.037 0.043" rgba="1 0 0 1" group="3"/>
                                    </body>
                                </body>
                                <body name="gripper_center_link" pos="0 0 0.13" quat="0 0 0 0">
                                    <site name="gripper_center" pos="0 0 0" rgba="1 0 0 1" size="0.02 0.02 0.02"></site>
                                </body>
                                <!-- 夹爪导入结束 -->

                            </body>
                        </body>
                    </body>
                </body>
            </body>
        </body>

        <!-- 添加实验台（桌子） -->
        <body pos="1.2 0.75 0.2" name="table0">
			<geom size="0.60 0.55 0.2" type="box" mass="2000" material="table_mat"></geom>
			<!-- <geom size="0.25 0.35 0.2" type="box" mass="2000" material="table_mat"></geom> -->
		</body>

        <!-- 添加被操作物体（小方块） -->
        <body name="object0" pos="1 0.45 0.425">
			<joint name="object0:joint" type="free" damping="0.01"></joint>
			<geom size="0.025 0.025 0.025" type="box" condim="3" name="object0" material="block0_mat" mass="2"></geom>
			<site name="object0" pos="0 0 0" size="0.02 0.02 0.02" rgba="1 0 0 1" type="sphere"></site>
			<site name="block_sensor" type="box" pos="0 0 0" size="0.02 0.02 0.02" euler="0 0 0" rgba="0.2 1 0.5 0.3"/>
		</body>

        <!-- 添加目标位置（小方平面） -->
		<body name="target0" pos="1.3 0.95 0.425">
			<site name="target0" pos="0 0 0.0001" size="0.038 0.038 0.001" rgba="0 1 0 0.3" type="box"></site>
		</body>

        <!-- 设置动作捕捉，用于机械臂的逆运动学位置驱动控制 -->
        <body mocap="true" name="robot_mocap" pos="0.75 0.75 1.705">
            <geom conaffinity="0" contype="0" pos="0 0 0" rgba="0 0.5 0 0.7" size="0.005 0.005 0.005" type="box"></geom>
            <geom conaffinity="0" contype="0" pos="1 0 0" rgba="1 0 0 0.1" size="1 0.005 0.005" type="box"></geom>
            <geom conaffinity="0" contype="0" pos="0 1 0" rgba="0 1 0 0.1" size="0.005 1 0.001" type="box"></geom>
            <geom conaffinity="0" contype="0" pos="0 0 1" rgba="0 0 1 0.1" size="0.005 0.005 1" type="box"></geom>
        </body>

    </worldbody>

    <!-- 将mocap固连到末端gripper_center_link的body上 -->
    <equality>
        <weld body1="robot_mocap" body2="link6" ></weld>
    </equality>

    <!-- E05 机械臂驱动 -->
    <actuator>
        <!-- <position name="joint1" ctrllimited="true" ctrlrange="-3.14159 3.14159" joint="joint1" kp="4000"/>
        <position name="joint2" ctrllimited="true" ctrlrange="-1.57 1.57" joint="joint2" kp="3000"/>
        <position name="joint3" ctrllimited="true" ctrlrange="-3.14159 3.14159" joint="joint3" kp="3000"/>
        <position name="joint4" ctrllimited="true" ctrlrange="-3.14159 3.14159" joint="joint4" kp="2000"/>
        <position name="joint5" ctrllimited="true" ctrlrange="-3.14159 3.14159" joint="joint5" kp="2000"/>
        <position name="joint6" ctrllimited="true" ctrlrange="-3.14159 3.14159" joint="joint6" kp="2000"/>      -->
        <position name="joint1" ctrllimited="true" ctrlrange="-3.14159 3.14159" joint="joint1" kp="2000"/>
        <position name="joint2" ctrllimited="true" ctrlrange="-1.57 1.57" joint="joint2" kp="2000"/>
        <position name="joint3" ctrllimited="true" ctrlrange="-3.14159 3.14159" joint="joint3" kp="1500"/>
        <position name="joint4" ctrllimited="true" ctrlrange="-3.14159 3.14159" joint="joint4" kp="800"/>
        <position name="joint5" ctrllimited="true" ctrlrange="-3.14159 3.14159" joint="joint5" kp="500"/>
        <position name="joint6" ctrllimited="true" ctrlrange="-3.14159 3.14159" joint="joint6" kp="500"/>     
    </actuator>

    <!-- Robotiq 2f-85 夹爪驱动 -->
    <contact>
        <exclude body1='robotiq_2f_85_right_spring_link' body2='robotiq_2f_85_right_follower'/>
        <exclude body1='robotiq_2f_85_left_spring_link' body2='robotiq_2f_85_left_follower'/>
    </contact>

    <sensor>
        <jointpos name="robotiq_2f_85" joint="robotiq_2f_85_right_driver_joint"/>
    </sensor>

    <equality>
        <connect anchor="0 0.037 0.043" body1="robotiq_2f_85_right_spring_link" body2="robotiq_2f_85_right_follower" name="robotiq_2f_85_right"/>
        <connect anchor="0 0.037 0.043" body1="robotiq_2f_85_left_spring_link" body2="robotiq_2f_85_left_follower" name="robotiq_2f_85_left"/>
    </equality>

    <!-- ====== ACTUATION-Opt0: Joint constrainted: Joint mimic each other.  ====== -->
    <!-- <equality>
        <joint joint1="robotiq_2f_85_right_driver_joint" joint2="robotiq_2f_85_left_driver_joint"/>
    </equality>
    <actuator>
        <position name="robotiq_2f_85" joint="robotiq_2f_85_right_driver_joint" ctrlrange="0 1" ctrllimited="true"/>
    </actuator> -->

    <!-- ====== ACTUATION-Opt1: Individually actuated: Uses twice as many actuators than hardware ======-->
    <!-- <actuator>
        <position name="robotiq_2f_85_right" joint="robotiq_2f_85_right_driver_joint" ctrlrange="0 1" ctrllimited="true"/>
        <position name="robotiq_2f_85_left" joint="robotiq_2f_85_left_driver_joint" ctrlrange="0 1" ctrllimited="true"/>
    </actuator> -->

    <!-- ====== ACTUATION-Opt2: Tendon constrainted: Joints try to compensate for each other. We donot see this behavior in hardware ======-->
    <tendon>
        <fixed name="robotiq_2f_85_cplr">
            <joint joint="robotiq_2f_85_right_driver_joint" coef="1"/>
            <joint joint="robotiq_2f_85_left_driver_joint" coef="1"/>
        </fixed>
    </tendon>
     <actuator>
        <position name="robotiq_2f_85" tendon="robotiq_2f_85_cplr" ctrlrange="0 1" ctrllimited="true"/>
    </actuator>
</mujoco>
